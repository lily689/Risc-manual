\chapter{``Zihintntlh'' Non-Temporal Locality Hints, Version 0.1}
\label{chap:zihintpause}

The NTLH instructions are HINTs that indicate that the immediately subsequent
memory-access instruction exhibits poor temporal locality of reference.
The NTLH instructions do not change architectural state, nor do they alter the
architecturally visible effects of the subsequent memory-access instruction.
Three variants are provided:

The NTLH.L1 instruction indicates that the subsequent memory-access
instruction does not exhibit temporal locality that can be exploited by the
innermost level of the memory hierarchy (e.g., an L1 cache).
NTLH.L1 is encoded as ADD {\em x0, x0, x1}.
If the C extension is provided, an equivalent variant, C.NTLH.L1, is encoded
as C.ADD {\em x0, x1}.

The NTLH.L1L2 instruction indicates that the subsequent memory-access
instruction does not exhibit temporal locality that can be exploited by either
the innermost or next-innermost level of the memory hierarchy (e.g., L1 and L2
caches).
NTLH.L1L2 is encoded as ADD {\em x0, x0, x2}.
If the C extension is provided, an equivalent variant, C.NTLH.L1L2, is encoded
as C.ADD {\em x0, x2}.

The NTLH.ALL instruction indicates that the instruction does not exhibit
temporal locality that can be exploited by any level of the memory hierarchy.
NTLH.ALL is encoded as ADD {\em x0, x0, x3}.
If the C extension is provided, an equivalent variant, C.NTLH.ALL, is encoded
as C.ADD {\em x0, x3}.

\begin{commentary}
The NTLH instructions can be used to avoid cache pollution when streaming data
or traversing large data structures, or to reduce latency in producer-consumer
interactions.

A microarchitecture might use the NTLH instructions to inform the cache
replacement policy, or to decide which cache to allocate into, or to avoid
cache allocation altogether.
For example, NTLH.L1 might indicate that an implementation should not allocate
a line in an L1 cache, but should allocate in L2.
NTLH.L2 might indicate that an implementation should allocate in neither L1
nor L2, but should allocate in L3.

Like any HINT, these instructions may be freely ignored.
They may have different memory-hierarchy effects on different implementations:
e.g., a simple implementation might implement all three hints identically.
\end{commentary}

The NTLH instructions affect all memory-access instructions defined in the
base ISAs and the A, F, D, Q, C, and V standard extensions,
as well as those defined in the hypervisor extension defined in Volume II.

\begin{commentary}
The expectation is that the NTLH instructions will also affect memory-access
instructions defined in later standard or custom extensions.
\end{commentary}

Software is discouraged from following an NTLH instruction with an
instruction that does not explicitly access memory.
Nonadherence to this recommendation might reduce performance but
otherwise has no architecturally visible effect.

\begin{commentary}
If an interrupt occurs between the execution of an NTLH instruction and its
subsequent memory-access instruction, execution will normally resume at the
memory-access instruction.
That the NTLH instruction is not reexecuted does not change the semantics of
the program.
\end{commentary}
